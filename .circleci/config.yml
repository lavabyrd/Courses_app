version: 2
jobs:
  build:
    working_directory: /temp
    docker:
      - image: microsoft/dotnet:sdk
    environment:
      DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
      DOTNET_CLI_TELEMETRY_OPTOUT: 1
    machine:
      environment:
        user_id: $USER1
    steps:
      - add_ssh_keys: 
          fingerprints: 
            - "9c:8b:15:f2:a1:1d:ff:89:ac:c3:dd:49:09:44:f8:d8"
      - checkout
      - run: dotnet restore
      - run: dotnet build
      - run: dotnet publish -c Release --output ./published
      - run: ssh $user_id@178.62.60.163 -y rm -rf /app
      - run: scp -r ./published ${USER1}@178.62.60.163:/home/${USER1}/app 
      - run: ssh ${USER1}@178.62.60.163 sudo systemctl restart dotnet-core-app.service
      - store_artifacts:
          path: /temp/bin/Debug/netcoreapp2.0/Courses_app.dll